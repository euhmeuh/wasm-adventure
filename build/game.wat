(module (import "console" "log" (func $log (param i32) (param i32))) (import "console" "lognum" (func $log-num (param i32))) (memory 1)   (func $fill_pixels (param $pos i32) (param $len i32) (param $step i32) (param $color i32)  (loop $loop (block $done (br_if $done (i32.ge_u (get_local $pos) (get_local $len))) (call $pixel (get_local $pos) (get_local $color)) (set_local $pos (i32.add (get_local $pos) (get_local $step))) (br $loop)))) (func $fill_row (param $row i32) (param $color i32)  (local $i i32) (local $len i32) (set_local $i (i32.mul (i32.load (i32.const 0)) (get_local $row))) (set_local $len (i32.add (i32.load (i32.const 0)) (get_local $i))) (call $fill_pixels (get_local $i) (get_local $len) (i32.const 1) (get_local $color))) (func $fill_col (param $col i32) (param $color i32)  (local $len i32) (set_local $len (i32.mul (i32.load (i32.const 0)) (i32.load (i32.const 4)))) (call $fill_pixels (get_local $col) (get_local $len) (i32.load (i32.const 0)) (get_local $color))) (func $fill_screen (param $color i32)  (call $fill_pixels (i32.const 0) (i32.mul (i32.load (i32.const 0)) (i32.load (i32.const 4))) (i32.const 1) (get_local $color))) (func $pixel (param $pos i32) (param $color i32)  (local $cursor i32) (set_local $cursor (i32.add (i32.const 4092) (i32.mul (get_local $pos) (i32.const 4)))) (i32.store8 (get_local $cursor) (i32.load8_u (get_local $color))) (i32.store8 (i32.add (get_local $cursor) (i32.const 1)) (i32.load8_u (i32.add (get_local $color) (i32.const 1)))) (i32.store8 (i32.add (get_local $cursor) (i32.const 2)) (i32.load8_u (i32.add (get_local $color) (i32.const 2)))) (i32.store8 (i32.add (get_local $cursor) (i32.const 3)) (i32.const 255))) (func $plot (param $x i32) (param $y i32) (param $color i32)  (call $pixel (i32.add (get_local $x) (i32.mul (get_local $y) (i32.load (i32.const 4)))) (get_local $color))) (func $sprite (param $x i32) (param $y i32) (param $index i32)  (local $width i32) (local $height i32) (local $color i32) (local $i i32) (set_local $width (i32.load8_u (get_local $index))) (set_local $height (i32.load8_u (i32.add (i32.const 1) (get_local $index)))) (set_local $color (i32.add (i32.const 2) (get_local $index))) (loop $loop (block $done (br_if $done (i32.ge_u (get_local $i) (i32.mul (get_local $width) (get_local $height)))) (call $plot (i32.add (get_local $x) (i32.rem_u (get_local $i) (get_local $width))) (i32.add (get_local $y) (i32.div_u (get_local $i) (get_local $width))) (i32.add (i32.const 8) (i32.mul (i32.const 3) (i32.load8_u (i32.add (get_local $i) (get_local $color)))))) (set_local $i (i32.add (get_local $i) (i32.const 1))) (br $loop)))) (func $init (param $width i32) (param $height i32)  (i32.store (i32.const 0) (get_local $width)) (i32.store (i32.const 4) (get_local $height)) (grow_memory (i32.div_u (i32.add (i32.const 4092) (i32.mul (i32.const 4) (i32.mul (get_local $width) (get_local $height)))) (i32.const 65536))) (drop)) (func $hello  (call $log (i32.const 256) (i32.const 12))) (func $show-aliens  (local $i i32) (local $x i32) (local $y i32) (set_local $x (i32.load8_u (i32.const 2176))) (set_local $y (i32.load8_u (i32.const 2177))) (loop $loop (block $done (br_if $done (i32.ge_u (get_local $i) (i32.mul (i32.const 9) (i32.const 5)))) (if  (i32.load8_u (i32.add (get_local $i) (i32.const 2181))) (then (call $sprite (i32.add (get_local $x) (i32.mul (i32.rem_u (get_local $i) (i32.const 9)) (i32.const 15))) (i32.add (get_local $y) (i32.mul (i32.div_u (get_local $i) (i32.const 9)) (i32.const 15))) (i32.const 1024)))) (set_local $i (i32.add (get_local $i) (i32.const 1))) (br $loop)))) (func $show-player  (call $sprite (i32.load8_u (i32.const 2560)) (i32.load8_u (i32.const 2561)) (i32.const 1114))) (func $render  (call $fill_screen (i32.const 8)) (call $show-aliens) (call $show-player)) (func $move-aliens (param $delta i32)  (local $x i32) (local $y i32) (local $speed i32) (local $down i32) (local $direction i32) (set_local $x (i32.load8_u (i32.const 2176))) (set_local $y (i32.load8_u (i32.const 2177))) (set_local $speed (i32.load8_u (i32.const 2178))) (set_local $down (i32.load8_u (i32.const 2179))) (set_local $direction (i32.load8_u (i32.const 2180))) (if  (call $aliens-at-border? (get_local $direction)) (then (if  (i32.eq (get_local $down) (i32.const 0)) (then (set_local $down (i32.const 1)))) (if  (i32.ge_u (get_local $down) (i32.const 15)) (then (set_local $down (i32.const 0)) (set_local $direction (call $switch-direction (get_local $direction))))))) (if  (get_local $down) (then (set_local $y (i32.add (get_local $y) (get_local $speed))) (set_local $down (i32.add (get_local $down) (get_local $speed)))) (else (set_local $x (call $move (get_local $x) (get_local $direction) (get_local $speed))))) (i32.store8 (i32.const 2176) (get_local $x)) (i32.store8 (i32.const 2177) (get_local $y)) (i32.store8 (i32.const 2179) (get_local $down))) (func $move (param $pos i32) (param $direction i32) (param $speed i32) (result i32) (if (result i32) (i32.eq (get_local $direction) (i32.const 3)) (then (i32.add (get_local $pos) (get_local $speed))) (else (i32.sub (get_local $pos) (get_local $speed))))) (func $switch-direction (param $direction i32) (result i32) (set_local $direction (if (result i32) (i32.eq (get_local $direction) (i32.const 2)) (then (i32.const 3)) (else (i32.const 2)))) (i32.store8 (i32.const 2180) (get_local $direction)) (get_local $direction)) (func $aliens-at-border? (param $direction i32) (result i32) (local $x i32) (set_local $x (i32.load8_u (i32.const 2176))) (i32.or (i32.ge_u (get_local $x) (i32.const 80)) (i32.le_u (get_local $x) (i32.const 5)))) (func $update (param $delta i32)  (call $move-aliens (get_local $delta))) (export "memory" (memory 0)) (export "init" (func $init)) (export "render" (func $render)) (export "update" (func $update)) (export "hello" (func $hello)) (data (i32.const 0) "\00") (data (i32.const 4) "\00") (data (i32.const 8) "\00\00\00\ff\ff\ff\ff\00\00\00\ff\00\00\00\ff\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00") (data (i32.const 256) "Hello world!") (data (i32.const 1024) "\0b\08\00\00\01\00\00\00\00\00\01\00\00\00\00\00\01\00\00\00\01\00\00\00\00\00\01\01\01\01\01\01\01\00\00\00\01\01\00\01\01\01\00\01\01\00\01\01\01\01\01\01\01\01\01\01\01\01\00\01\01\01\01\01\01\01\00\01\01\00\01\00\00\00\00\00\01\00\01\00\00\00\01\01\00\01\01\00\00\00\0b\08\00\00\00\00\00\01\00\00\00\00\00\00\00\00\00\00\01\00\00\00\00\00\00\00\00\00\00\01\00\00\00\00\00\00\01\00\00\01\01\01\00\00\01\00\01\01\01\01\01\00\01\01\01\01\01\01\01\01\01\01\01\01\01\01\01\01\01\00\01\01\01\01\01\01\01\00\01\01\00\01\00\01\01\01\00\01\00\01") (data (i32.const 2048) "\00\00\00\00\00\00\00\03\00\00\00\00") (data (i32.const 2176) "\0a\0a\01\00\03\01\01\01\01\01\01\01\01\01\01\01\00\01\01\01\00\01\01\01\01\01\01\01\01\01\01\01\01\01\01\01\01\01\01\01\01\01\00\01\01\00\01\01\00\01") (data (i32.const 2560) "\6e\c8") (data (i32.const 2670) "SIM\03\f9\40\aaJER\02\a6\2b\1cBEN\00\9a\21\12AAA\00\89\54\40BBB\00\4c\4b\40CCC\00\26\25\a0DDD\00\01\86\a0EEE\00\00\27\10FFF\00\00\13\88GGG\00\00\01\f4") (data (i32.const 4092) "\00"))